module.exports=function(e,t,n){function a(e){u.push(e);o+=e.length;if(r!==null&&o>r){var t=new Error("request entity too large");t.status=413;t.received=o;t.limit=r;n(t);l()}}function f(){if(i!==null&&o!==i){var e=new Error("request size did not match content length");e.status=400;e.received=o;e.expected=i;n(e)}else n(null,Buffer.concat(u));l()}function l(){o=u=null;e.removeListener("data",a);e.removeListener("end",f);e.removeListener("error",n);e.removeListener("error",l);e.removeListener("close",l)}if(typeof t=="function"){n=t;t={}}var r=typeof t.limit=="number"?t.limit:null,i=isNaN(t.expected)?null:parseInt(t.expected,10);if(r!==null&&i!==null&&i>r){var s=new Error("request entity too large");s.status=413;s.expected=i;s.limit=r;n(s);e.resume();l();return}var o=0,u=[];e.on("data",a);e.once("end",f);e.once("error",n);e.once("error",l);e.once("close",l)};